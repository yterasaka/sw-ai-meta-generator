{"version":3,"file":"ai-meta-generator-0jP1cq7y.js","sources":["../../../app/administration/src/service/ai-meta-generator-api.service.js","../../../app/administration/src/extension/sw-product/component/sw-product-seo-form/sw-product-seo-form.html.twig","../../../app/administration/src/extension/sw-product/component/sw-product-seo-form/index.js","../../../app/administration/src/component/ai-meta-generator-test-button/ai-meta-generator-test-button.html.twig","../../../app/administration/src/component/ai-meta-generator-test-button/index.js"],"sourcesContent":["const { Application } = Shopware;\n\nclass AiMetaGeneratorApiService {\n  constructor(httpClient, loginService) {\n    this.httpClient = httpClient;\n    this.loginService = loginService;\n  }\n\n  generateMetadata(productData) {\n    const headers = this.getBasicHeaders();\n\n    return this.httpClient\n      .post(\"_action/ai-meta-generator/generate\", productData, { headers })\n      .then((response) => {\n        return response.data;\n      })\n      .catch((error) => {\n        throw error;\n      });\n  }\n\n  getBasicHeaders() {\n    return {\n      Accept: \"application/vnd.api+json\",\n      Authorization: `Bearer ${this.loginService.getToken()}`,\n      \"Content-Type\": \"application/json\",\n    };\n  }\n\n  testConnection(data) {\n    const headers = this.getBasicHeaders();\n\n    return this.httpClient\n      .post(\"_action/ai-meta-generator/test-connection\", data, { headers })\n      .then((response) => {\n        return response.data;\n      })\n      .catch((error) => {\n        throw error;\n      });\n  }\n}\n\nApplication.addServiceProvider(\"aiMetaGeneratorApiService\", (container) => {\n  const initContainer = Application.getContainer(\"init\");\n\n  return new AiMetaGeneratorApiService(\n    initContainer.httpClient,\n    container.loginService\n  );\n});\n","{% block sw_product_seo_form_keywords %}\n    {% parent %}\n    \n    {% block sw_product_seo_form_ai_generator_button %}\n    <div class=\"sw-field sw-field--default\">\n        <div class=\"sw-field__label\">\n            <label class=\"sw-field__label-text\">\n                {{ $tc('sw-product.seoForm.generateMetadataLabel') }}\n            </label>\n            <sw-help-text \n                :text=\"$tc('sw-product.seoForm.generateMetadataHelpText')\">\n            </sw-help-text>\n        </div>\n        <div class=\"sw-field__content\">\n            <sw-button \n                variant=\"primary\" \n                size=\"small\"\n                :disabled=\"isGenerating || !canGenerateMetadata\"\n                :isLoading=\"isGenerating\"\n                @click=\"onGenerateMetadata\">\n                {{ $tc('sw-product.seoForm.generateMetadata') }}\n            </sw-button>\n        </div>\n    </div>\n    {% endblock %}\n{% endblock %}","import template from \"./sw-product-seo-form.html.twig\";\n\nconst { Component, Mixin } = Shopware;\n\nComponent.override(\"sw-product-seo-form\", {\n  template,\n\n  inject: [\"aiMetaGeneratorApiService\"],\n\n  mixins: [Mixin.getByName(\"notification\")],\n\n  data() {\n    return {\n      isGenerating: false,\n    };\n  },\n\n  computed: {\n    canGenerateMetadata() {\n      return (\n        this.product &&\n        this.product.name &&\n        this.product.name.trim() !== \"\" &&\n        this.product.description &&\n        this.product.description.trim() !== \"\"\n      );\n    },\n  },\n\n  methods: {\n    async onGenerateMetadata() {\n      if (!this.product) {\n        this.createNotificationError({\n          message: this.$tc(\"sw-product.seoForm.errorProductNotFound\"),\n        });\n        return;\n      }\n\n      if (!this.canGenerateMetadata) {\n        this.createNotificationError({\n          message: this.$tc(\"sw-product.seoForm.errorMissingRequiredFields\"),\n        });\n        return;\n      }\n\n      this.isGenerating = true;\n\n      try {\n        const currentLanguageId = Shopware.Context.api.languageId;\n\n        const requestData = {\n          productId: this.product.id,\n          productName: this.product.name,\n          description: this.product.description,\n          languageId: currentLanguageId,\n        };\n\n        const response = await this.aiMetaGeneratorApiService.generateMetadata(\n          requestData\n        );\n\n        if (response.success) {\n          this.updateProductMetadata(response.data);\n          this.createNotificationSuccess({\n            message: this.$tc(\"sw-product.seoForm.metadataGeneratedSuccess\"),\n          });\n        } else {\n          throw new Error(response.error || \"Unknown error occurred\");\n        }\n      } catch (error) {\n        let errorMessage = error.message;\n\n        if (\n          error.response &&\n          error.response.data &&\n          error.response.data.error\n        ) {\n          errorMessage = error.response.data.error;\n        }\n\n        this.createNotificationError({\n          message:\n            this.$tc(\"sw-product.seoForm.errorGeneratingMetadata\") +\n            \": \" +\n            errorMessage,\n        });\n      } finally {\n        this.isGenerating = false;\n      }\n    },\n\n    updateProductMetadata(metadata) {\n      if (!this.product) {\n        console.error(\"Product not found\");\n        return;\n      }\n\n      if (metadata.metaTitle) {\n        this.product.metaTitle = metadata.metaTitle;\n      }\n\n      if (metadata.metaDescription) {\n        this.product.metaDescription = metadata.metaDescription;\n      }\n\n      if (metadata.keywords) {\n        this.product.keywords = metadata.keywords;\n      }\n\n      this.$emit(\"product-changed\");\n    },\n  },\n});\n","<div class=\"ai-meta-generator-test-button\">\n    <sw-button\n        variant=\"primary\" \n        @click=\"testConnection\"\n        :disabled=\"testing || !hasApiKey\"\n        :isLoading=\"testing\"> \n        {{ testing ? $tc('ai-meta-generator.settings.testing') : $tc('ai-meta-generator.settings.testConnection') }}\n    </sw-button>\n</div>","import template from \"./ai-meta-generator-test-button.html.twig\";\n\nconst { Component, Mixin } = Shopware;\n\nComponent.register(\"ai-meta-generator-test-button\", {\n  template,\n\n  mixins: [Mixin.getByName(\"notification\")],\n\n  inject: [\"systemConfigApiService\", \"aiMetaGeneratorApiService\"],\n\n  data() {\n    return {\n      testing: false,\n      hasApiKey: false,\n    };\n  },\n\n  async created() {\n    await this.checkApiKey();\n  },\n\n  methods: {\n    async checkApiKey() {\n      try {\n        const config = await this.systemConfigApiService.getValues(\n          \"AiMetaGenerator.config\"\n        );\n        const apiKey = config[\"AiMetaGenerator.config.openaiApiKey\"];\n        this.hasApiKey = apiKey && apiKey.trim() !== \"\";\n      } catch (error) {\n        this.hasApiKey = false;\n      }\n    },\n\n    async testConnection() {\n      this.testing = true;\n\n      try {\n        const config = await this.systemConfigApiService.getValues(\n          \"AiMetaGenerator.config\"\n        );\n        const apiKey = config[\"AiMetaGenerator.config.openaiApiKey\"];\n\n        if (!apiKey) {\n          this.createNotificationError({\n            message: this.$tc(\"ai-meta-generator.settings.apiKeyRequired\"),\n          });\n          return;\n        }\n\n        const response = await this.aiMetaGeneratorApiService.testConnection({\n          apiKey: apiKey,\n        });\n\n        if (response.success) {\n          this.createNotificationSuccess({\n            message: this.$tc(\"ai-meta-generator.settings.testSuccessful\"),\n          });\n        } else {\n          const errorMessage = this.getErrorMessage(response.statusCode);\n          this.createNotificationError({\n            message:\n              this.$tc(\"ai-meta-generator.settings.testFailed\") +\n              \": \" +\n              errorMessage,\n          });\n        }\n      } catch (error) {\n        this.createNotificationError({\n          message:\n            this.$tc(\"ai-meta-generator.settings.testFailed\") +\n            \": \" +\n            this.$tc(\"ai-meta-generator.settings.connectionError\"),\n        });\n      } finally {\n        this.testing = false;\n      }\n    },\n\n    getErrorMessage(statusCode) {\n      switch (statusCode) {\n        case 401:\n          return this.$tc(\"ai-meta-generator.settings.invalidApiKey\");\n        case 429:\n          return this.$tc(\"ai-meta-generator.settings.quotaExceeded\");\n        case 0:\n          return this.$tc(\"ai-meta-generator.settings.connectionError\");\n        default:\n          return this.$tc(\"ai-meta-generator.settings.unexpectedError\", {\n            statusCode,\n          });\n      }\n    },\n  },\n});\n"],"names":["Application","AiMetaGeneratorApiService","httpClient","loginService","productData","headers","response","error","data","container","initContainer","template$1","Component","Mixin","template","currentLanguageId","requestData","errorMessage","metadata","apiKey","statusCode"],"mappings":"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"}