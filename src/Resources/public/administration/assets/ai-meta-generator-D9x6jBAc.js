const{Application:a}=Shopware;class s{constructor(t,i){this.httpClient=t,this.loginService=i}generateMetadata(t){const i=this.getBasicHeaders();return this.httpClient.post("_action/ai-meta-generator/generate",t,{headers:i}).then(r=>r.data).catch(r=>{throw r})}getBasicHeaders(){return{Accept:"application/vnd.api+json",Authorization:`Bearer ${this.loginService.getToken()}`,"Content-Type":"application/json"}}testConnection(t){const i=this.getBasicHeaders();return this.httpClient.post("_action/ai-meta-generator/test-connection",t,{headers:i}).then(r=>r.data).catch(r=>{throw r})}}a.addServiceProvider("aiMetaGeneratorApiService",e=>{const t=a.getContainer("init");return new s(t.httpClient,e.loginService)});const n=`{% block sw_product_seo_form_keywords %} {% parent %} {% block sw_product_seo_form_ai_generator_button %} <div class="sw-field sw-field--default"> <div class="sw-field__label"> <label class="sw-field__label-text"> {{ $tc('sw-product.seoForm.generateMetadataLabel') }} </label> <sw-help-text :text="$tc('sw-product.seoForm.generateMetadataHelpText')"> </sw-help-text> </div> <div class="sw-field__content"> <sw-button variant="primary" size="small" :disabled="isGenerating || !canGenerateMetadata" :isLoading="isGenerating" @click="onGenerateMetadata"> {{ $tc('sw-product.seoForm.generateMetadata') }} </sw-button> </div> </div> {% endblock %} {% endblock %}`,{Component:o,Mixin:c}=Shopware;o.override("sw-product-seo-form",{template:n,inject:["aiMetaGeneratorApiService","systemConfigApiService"],mixins:[c.getByName("notification")],data(){return{isGenerating:!1,hasApiKey:!1}},async created(){await this.checkApiKey()},computed:{canGenerateMetadata(){return this.hasApiKey&&this.product&&this.product.name&&this.product.name.trim()!==""&&this.product.description&&this.product.description.trim()!==""}},methods:{async checkApiKey(){try{const t=(await this.systemConfigApiService.getValues("AiMetaGenerator.config"))["AiMetaGenerator.config.openaiApiKey"];this.hasApiKey=t&&t.trim()!==""}catch{this.hasApiKey=!1}},async onGenerateMetadata(){if(!this.product){this.createNotificationError({message:this.$tc("sw-product.seoForm.errorProductNotFound")});return}if(!this.canGenerateMetadata){this.createNotificationError({message:this.$tc("sw-product.seoForm.errorMissingRequiredFields")});return}if(!this.hasApiKey){this.createNotificationError({message:this.$tc("sw-product.seoForm.errorApiKeyNotConfigured")});return}this.isGenerating=!0;try{const e=Shopware.Context.api.languageId,t={productId:this.product.id,productName:this.product.name,description:this.product.description,languageId:e},i=await this.aiMetaGeneratorApiService.generateMetadata(t);if(i.success)this.updateProductMetadata(i.data),this.createNotificationSuccess({message:this.$tc("sw-product.seoForm.metadataGeneratedSuccess")});else throw new Error(i.error||"Unknown error occurred")}catch(e){let t=e.message;e.response&&e.response.data&&e.response.data.error&&(t=e.response.data.error),this.createNotificationError({message:this.$tc("sw-product.seoForm.errorGeneratingMetadata")+": "+t})}finally{this.isGenerating=!1}},updateProductMetadata(e){if(!this.product){console.error("Product not found");return}e.metaTitle&&(this.product.metaTitle=e.metaTitle),e.metaDescription&&(this.product.metaDescription=e.metaDescription),e.keywords&&(this.product.keywords=e.keywords),this.$emit("product-changed")}}});const d=`<div class="ai-meta-generator-test-button"> <sw-button variant="primary" @click="testConnection" :disabled="testing || !hasApiKey" :isLoading="testing"> {{ testing ? $tc('ai-meta-generator.settings.testing') : $tc('ai-meta-generator.settings.testConnection') }} </sw-button> </div>`,{Component:p,Mixin:h}=Shopware;p.register("ai-meta-generator-test-button",{template:d,mixins:[h.getByName("notification")],inject:["systemConfigApiService","aiMetaGeneratorApiService"],data(){return{testing:!1,hasApiKey:!1}},async created(){await this.checkApiKey()},methods:{async checkApiKey(){try{const t=(await this.systemConfigApiService.getValues("AiMetaGenerator.config"))["AiMetaGenerator.config.openaiApiKey"];this.hasApiKey=t&&t.trim()!==""}catch{this.hasApiKey=!1}},async testConnection(){this.testing=!0;try{const t=(await this.systemConfigApiService.getValues("AiMetaGenerator.config"))["AiMetaGenerator.config.openaiApiKey"];if(!t){this.createNotificationError({message:this.$tc("ai-meta-generator.settings.apiKeyRequired")});return}const i=await this.aiMetaGeneratorApiService.testConnection({apiKey:t});if(i.success)this.createNotificationSuccess({message:this.$tc("ai-meta-generator.settings.testSuccessful")});else{const r=this.getErrorMessage(i.statusCode);this.createNotificationError({message:this.$tc("ai-meta-generator.settings.testFailed")+": "+r})}}catch{this.createNotificationError({message:this.$tc("ai-meta-generator.settings.testFailed")+": "+this.$tc("ai-meta-generator.settings.connectionError")})}finally{this.testing=!1}},getErrorMessage(e){switch(e){case 401:return this.$tc("ai-meta-generator.settings.invalidApiKey");case 429:return this.$tc("ai-meta-generator.settings.quotaExceeded");case 0:return this.$tc("ai-meta-generator.settings.connectionError");default:return this.$tc("ai-meta-generator.settings.unexpectedError",{statusCode:e})}}}});
//# sourceMappingURL=ai-meta-generator-D9x6jBAc.js.map
